import cv2
import numpy as np

HSV_RANGES = {

    "Apple": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((0, 40, 40), (20, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    },

    "Apricot": {
        "verde": ((30, 40, 40), (60, 255, 255)),
        "maduro": ((15, 40, 40), (29, 255, 255)),
        "pasado": ((10, 20, 20), (14, 255, 80))
    },

    "Avocado": {
        "verde": ((40, 40, 40), (85, 255, 255)),
        "maduro": ((20, 40, 40), (39, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    },

    "Banana": {
        "verde": ((40, 40, 40), (75, 255, 255)),
        "maduro": ((20, 40, 40), (39, 255, 255)),
        "pasado": ((10, 20, 20), (19, 255, 80))
    },

    "Dragonfruit": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((0, 40, 40), (10, 255, 255)),
        "pasado": ((0, 0, 20), (180, 50, 80))
    },

    "Kiwi": {
        "verde": ((40, 40, 40), (85, 255, 255)),
        "maduro": ((20, 40, 40), (39, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    },

    "Lemon": {
        "verde": ((35, 40, 40), (60, 255, 255)),
        "maduro": ((20, 40, 40), (34, 255, 255)),
        "pasado": ((15, 20, 20), (19, 255, 80))
    },

    "Lemon Meyer": {
        "verde": ((35, 40, 40), (60, 255, 255)),
        "maduro": ((20, 40, 40), (34, 255, 255)),
        "pasado": ((15, 20, 20), (19, 255, 80))
    },

    "Limes": {
        "verde": ((45, 40, 40), (85, 255, 255)),
        "maduro": ((30, 40, 40), (44, 255, 255)),
        "pasado": ((20, 20, 20), (29, 255, 80))
    },

    "Mandarine": {
        "verde": ((30, 40, 40), (60, 255, 255)),
        "maduro": ((10, 40, 40), (29, 255, 255)),
        "pasado": ((0, 20, 20), (9, 255, 80))
    },

    "Mango": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((15, 40, 40), (34, 255, 255)),
        "pasado": ((10, 20, 20), (14, 255, 80))
    },

    "Mango Red": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((0, 40, 40), (15, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    },

    "Orange": {
        "verde": ((30, 40, 40), (60, 255, 255)),
        "maduro": ((10, 40, 40), (29, 255, 255)),
        "pasado": ((0, 20, 20), (9, 255, 80))
    },

    "Papaya": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((20, 40, 40), (34, 255, 255)),
        "pasado": ((10, 20, 20), (19, 255, 80))
    },

    "Peach": {
        "verde": ((30, 40, 40), (60, 255, 255)),
        "maduro": ((10, 40, 40), (29, 255, 255)),
        "pasado": ((0, 20, 20), (9, 255, 80))
    },

    "Pear": {
        "verde": ((40, 40, 40), (85, 255, 255)),
        "maduro": ((25, 40, 40), (39, 255, 255)),
        "pasado": ((15, 20, 20), (24, 255, 80))
    },

    "Plum": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((125, 40, 40), (160, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    },

    "Pomelo": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((10, 40, 40), (29, 255, 255)),
        "pasado": ((0, 20, 20), (9, 255, 80))
    },

    "Strawberry": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((0, 40, 40), (10, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    },

    "Tomato": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((0, 40, 40), (10, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    },

    "Watermelon": {
        "verde": ((35, 40, 40), (85, 255, 255)),
        "maduro": ((0, 40, 40), (20, 255, 255)),
        "pasado": ((0, 0, 20), (180, 60, 80))
    }
}

def estimate_maturity(image, fruit):
    hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)
    mean_hsv = np.mean(hsv.reshape(-1, 3), axis=0)
    h, s, v = mean_hsv

    if fruit not in HSV_RANGES:
        return "desconocido"

    for state, (low, high) in HSV_RANGES[fruit].items():
        if low[0] <= h <= high[0]:
            return state

    return "indeterminado"
